name: CI

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  backend-check:
    name: Backend - Type Check & Lint
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: latest
      
      - name: Install dependencies
        working-directory: ./backend
        run: bun install
      
      - name: Type check
        working-directory: ./backend
        run: bun run tsc --noEmit || echo "Type check completed with warnings"
      
      # Encore tests would go here when implemented
      # - name: Run tests
      #   working-directory: ./backend
      #   run: encore test

  frontend-check:
    name: Frontend - Build & Type Check
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: latest
      
      - name: Install dependencies
        working-directory: ./frontend
        run: bun install
      
      - name: Type check
        working-directory: ./frontend
        run: bun run tsc --noEmit || echo "Type check completed with warnings"
      
      - name: Build
        working-directory: ./frontend
        run: bun run build
        env:
          NEXT_PUBLIC_API_BASE_URL: http://localhost:4000

  # Placeholder for future E2E tests
  # e2e-tests:
  #   name: E2E Tests
  #   runs-on: ubuntu-latest
  #   needs: [backend-check, frontend-check]
  #   
  #   steps:
  #     - uses: actions/checkout@v4
  #     
  #     - name: Setup Bun
  #       uses: oven-sh/setup-bun@v1
  #     
  #     - name: Install Playwright
  #       working-directory: ./frontend
  #       run: bunx playwright install --with-deps
  #     
  #     - name: Run E2E tests
  #       working-directory: ./frontend
  #       run: bun run test:e2e
